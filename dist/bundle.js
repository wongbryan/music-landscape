function Ellipse(e,t,n){THREE.Curve.call(this),this.xRadius=e,this.yRadius=t,this.rotation=n}function keyToCode(e){return Object.keys(KEYCODES)[Object.values(KEYCODES).indexOf(e)]}function codeToKey(e){return KEYCODES[e]}function resize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function updateCamera(){pov?camera.position.copy(Avatar.position).add(new THREE.Vector3(0,5,10)):(camera.lookAt(Avatar.position),camera.position.copy(Avatar.position).sub(new THREE.Vector3(0,10,-10)))}function toggleCamera(){activeCamera=activeCamera==camera?outerCamera:camera}function update(){for(var e in OBJECTS)OBJECTS[e].update()}function loop(){update(),renderer.render(scene,activeCamera),window.requestAnimationFrame(loop)}function init(){var e=document.getElementById("container");(renderer=new THREE.WebGLRenderer({antialias:!0})).shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCSoftShadowMap,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(12576767),e.appendChild(renderer.domElement),(camera=new THREE.PerspectiveCamera(105,window.innerWidth/window.innerHeight,1e-4,1e4)).position.set(0,5,10),camera.lookAt(new THREE.Vector3(0,0,0)),(outerCamera=new THREE.PerspectiveCamera(105,window.innerWidth/window.innerHeight,1e-4,1e4)).position.set(0,10,15),controls=new THREE.OrbitControls(outerCamera,renderer.domElement),(scene=new THREE.Scene).add(camera),scene.add(outerCamera),scene.fog=new THREE.FogExp2(9100543,.015);var t=new THREE.DirectionalLight(16774390,.7);t.position.set(-5,5,1),t.castShadow=!0;var n=new THREE.AmbientLight(16415986),a=[];a[0]=new THREE.PointLight(16777215,1,100),a[1]=new THREE.PointLight(16777215,1,100),a[2]=new THREE.PointLight(16777215,1,100),a[0].position.set(0,50,50),a[1].position.set(-50,0,50),a[2].position.set(50,-50,50);for(var o=0;o<a.length;o++){scene.add(a[o]);var r=new THREE.PointLightHelper(a[o],1);scene.add(r)}scene.add(n),scene.add(t);var i=new THREE.MeshPhongMaterial({color:new THREE.Color(16744138),emissive:new THREE.Color(8984397),specular:new THREE.Color(12452955),side:THREE.DoubleSide,shininess:100});for(var s in OBJECTS)switch(s){case"Universe":var l=InitUniverse(25,5,camera);scene.add(l.mesh),OBJECTS[s]=l;break;case"Planet":var c=InitPlanet(i),d=0,E=2*Math.PI/5*d,u=25*Math.cos(E),h=25*Math.sin(E);c.mesh.position.x=u,c.mesh.position.z=h,scene.add(c.mesh),OBJECTS[s]=c;break;case"Planet2":var c=InitPlanet(i),d=1,E=2*Math.PI/5*d,u=25*Math.cos(E),h=25*Math.sin(E);c.mesh.position.x=u,c.mesh.position.z=h,scene.add(c.mesh),OBJECTS[s]=c;break;case"Planet3":var c=InitPlanet(i),d=2,E=2*Math.PI/5*d,u=25*Math.cos(E),h=25*Math.sin(E);c.mesh.position.x=u,c.mesh.position.z=h,scene.add(c.mesh),OBJECTS[s]=c;break;case"Planet4":var c=InitPlanet(i),d=3,E=2*Math.PI/5*d,u=25*Math.cos(E),h=25*Math.sin(E);c.mesh.position.x=u,c.mesh.position.z=h,scene.add(c.mesh),OBJECTS[s]=c;break;case"Planet5":var c=InitPlanet(i),d=4,E=2*Math.PI/5*d,u=25*Math.cos(E),h=25*Math.sin(E);c.mesh.position.x=u,c.mesh.position.z=h,scene.add(c.mesh),OBJECTS[s]=c;break;case"CenterPlanet":CenterPlanet=InitCenterPlanet(i),scene.add(CenterPlanet.mesh),OBJECTS.CenterPlanet=CenterPlanet}window.addEventListener("resize",resize),window.addEventListener("mousedown",toggleCamera),loop()}!function(e){function t(e,t,n){this.x=e,this.y=t,this.z=n}function n(e){return e*e*e*(e*(6*e-15)+10)}function a(e,t,n){return(1-n)*e+n*t}var o=e.noise={};t.prototype.dot2=function(e,t){return this.x*e+this.y*t},t.prototype.dot3=function(e,t,n){return this.x*e+this.y*t+this.z*n};var r=[new t(1,1,0),new t(-1,1,0),new t(1,-1,0),new t(-1,-1,0),new t(1,0,1),new t(-1,0,1),new t(1,0,-1),new t(-1,0,-1),new t(0,1,1),new t(0,-1,1),new t(0,1,-1),new t(0,-1,-1)],i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],s=new Array(512),l=new Array(512);o.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;n=1&t?i[t]^255&e:i[t]^e>>8&255,s[t]=s[t+256]=n,l[t]=l[t+256]=r[n%12]}},o.seed(0);var c=.5*(Math.sqrt(3)-1),d=(3-Math.sqrt(3))/6;o.simplex2=function(e,t){var n,a,o,r,i,E=(e+t)*c,u=Math.floor(e+E),h=Math.floor(t+E),v=(u+h)*d,m=e-u+v,w=t-h+v;m>w?(r=1,i=0):(r=0,i=1);var p=m-r+d,f=w-i+d,T=m-1+2*d,H=w-1+2*d,R=l[(u&=255)+s[h&=255]],M=l[u+r+s[h+i]],g=l[u+1+s[h+1]],C=.5-m*m-w*w;n=C<0?0:(C*=C)*C*R.dot2(m,w);var P=.5-p*p-f*f;a=P<0?0:(P*=P)*P*M.dot2(p,f);var S=.5-T*T-H*H;return o=S<0?0:(S*=S)*S*g.dot2(T,H),70*(n+a+o)},o.simplex3=function(e,t,n){var a,o,r,i,c,d,E,u,h,v,m=(e+t+n)*(1/3),w=Math.floor(e+m),p=Math.floor(t+m),f=Math.floor(n+m),T=(w+p+f)*(1/6),H=e-w+T,R=t-p+T,M=n-f+T;H>=R?R>=M?(c=1,d=0,E=0,u=1,h=1,v=0):H>=M?(c=1,d=0,E=0,u=1,h=0,v=1):(c=0,d=0,E=1,u=1,h=0,v=1):R<M?(c=0,d=0,E=1,u=0,h=1,v=1):H<M?(c=0,d=1,E=0,u=0,h=1,v=1):(c=0,d=1,E=0,u=1,h=1,v=0);var g=H-c+1/6,C=R-d+1/6,P=M-E+1/6,S=H-u+1/6*2,y=R-h+1/6*2,x=M-v+1/6*2,b=H-1+.5,A=R-1+.5,B=M-1+.5,L=l[(w&=255)+s[(p&=255)+s[f&=255]]],I=l[w+c+s[p+d+s[f+E]]],O=l[w+u+s[p+h+s[f+v]]],z=l[w+1+s[p+1+s[f+1]]],D=.6-H*H-R*R-M*M;a=D<0?0:(D*=D)*D*L.dot3(H,R,M);var G=.6-g*g-C*C-P*P;o=G<0?0:(G*=G)*G*I.dot3(g,C,P);var k=.6-S*S-y*y-x*x;r=k<0?0:(k*=k)*k*O.dot3(S,y,x);var J=.6-b*b-A*A-B*B;return i=J<0?0:(J*=J)*J*z.dot3(b,A,B),32*(a+o+r+i)},o.perlin2=function(e,t){var o=Math.floor(e),r=Math.floor(t);e-=o,t-=r;var i=l[(o&=255)+s[r&=255]].dot2(e,t),c=l[o+s[r+1]].dot2(e,t-1),d=l[o+1+s[r]].dot2(e-1,t),E=l[o+1+s[r+1]].dot2(e-1,t-1),u=n(e);return a(a(i,d,u),a(c,E,u),n(t))},o.perlin3=function(e,t,o){var r=Math.floor(e),i=Math.floor(t),c=Math.floor(o);e-=r,t-=i,o-=c;var d=l[(r&=255)+s[(i&=255)+s[c&=255]]].dot3(e,t,o),E=l[r+s[i+s[c+1]]].dot3(e,t,o-1),u=l[r+s[i+1+s[c]]].dot3(e,t-1,o),h=l[r+s[i+1+s[c+1]]].dot3(e,t-1,o-1),v=l[r+1+s[i+s[c]]].dot3(e-1,t,o),m=l[r+1+s[i+s[c+1]]].dot3(e-1,t,o-1),w=l[r+1+s[i+1+s[c]]].dot3(e-1,t-1,o),p=l[r+1+s[i+1+s[c+1]]].dot3(e-1,t-1,o-1),f=n(e),T=n(t),H=n(o);return a(a(a(d,v,f),a(E,m,f),H),a(a(u,w,f),a(h,p,f),H),T)}}(this);const SHADERS={instancing:{vertex:["uniform float time;","uniform float minX;","uniform float length;","attribute vec3 translate;","varying float vScale;","varying vec2 vUv;","void main(){","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( translate, 1.0 );","vec3 trTime = vec3(translate.x + time, translate.y + time,translate.z + time);","float scale = abs(cos( 3.14159*trTime.x / (length*3.) )) + sin( trTime.y * 3.2 ) + sin(trTime.z * 4.);","vScale = scale;","mvPosition.xyz += position * scale * .1;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D map;","varying vec2 vUv;","varying float vScale;","vec3 HUEtoRGB(float H){","H = mod(H,1.0);","float R = abs(H * 6.0 - 3.0) - 1.0;","float G = 2.0 - abs(H * 6.0 - 2.0);","float B = 2.0 - abs(H * 6.0 - 4.0);","return clamp(vec3(R,G,B),0.0,1.0);","}","vec3 HSLtoRGB(vec3 HSL){","vec3 RGB = HUEtoRGB(HSL.x);","float C = (1.0 - abs(2.0 * HSL.z - 1.0)) * HSL.y;","return (RGB - 0.5) * C + HSL.z;","}","void main() {","vec4 diffuseColor = texture2D( map, vUv );","gl_FragColor = vec4( diffuseColor.xyz * HSLtoRGB(vec3(vScale/5.0, 1.0, 0.5)), diffuseColor.w );","// gl_FragColor = vec4(diffuseColor.xyz * vec3(1., .6, 1.), 1.);","if ( diffuseColor.w < 0.5 ) discard;","}"].join("\n")}};var MODEL_DATA=[{url:"assets/models/banana.json",geometry:null,key:"a",materials:null,sound:""}],MATERIALS={bubbleGum:new THREE.MeshPhongMaterial({color:new THREE.Color(16744138),emissive:new THREE.Color(8984397),specular:new THREE.Color(12452955),side:THREE.DoubleSide,shininess:100})},OBJECTS={CenterPlanet:null,Planet:null,Planet2:null,Planet3:null,Planet4:null,Planet5:null,Universe:null};Ellipse.prototype=Object.create(THREE.Curve.prototype),Ellipse.prototype.constructor=Ellipse,Ellipse.prototype.getPoint=function(e){var t=2*Math.PI*e,n=Math.cos(this.rotation),a=Math.sin(this.rotation);return new THREE.Vector3(this.xRadius*Math.cos(t)*n,this.yRadius*Math.sin(t),-this.xRadius*Math.cos(t)*a)};var Universe,CenterPlanet,Planet,Avatar,InitUniverse=function(e,t){var n=e,a=MATERIALS.bubbleGum.clone();a.side=THREE.FrontSide;var o=new THREE.Mesh(new THREE.SphereGeometry(.5,64,64),a);camera.add(o),camera.position.set(0,0,n),activeCamera=camera;var r=new THREE.Group,i=[];i[0]=new Ellipse(e-2,e-2,Math.PI),i[1]=new Ellipse(e,e,Math.PI),i[2]=new Ellipse(e+2,e+2,Math.PI);for(var s=0,l=0;l<i.length;l++){var c=i[l],d=new THREE.Path(c.getPoints(100)).createPointsGeometry(100),E=new THREE.LineBasicMaterial({color:16777215,linewidth:2}),u=new THREE.Line(d,E);u.rotation.x=Math.PI/2,r.add(u)}var h=0,v=0,m=new THREE.Vector3(0,0,0);return{mesh:r,orbitPaths:i,update:function(){s+=.005,v+=.01,h=2*Math.PI/1e3;var e=camera.position.x,t=camera.position.z;camera.position.x=e*Math.cos(h)+t*Math.sin(h),camera.position.y=0,camera.position.z=t*Math.cos(h)-e*Math.sin(h),camera.lookAt(m)}}},InitCenterPlanet=function(e){var t=new THREE.CircleBufferGeometry(1,6),n=new THREE.InstancedBufferGeometry;n.copy(t);for(var a=e.vertices,o=a.length,r=0,i=new Float32Array(3*o),s=0;s<a.length;s++){var l=3*s,c=a[s];r>c.x&&(r=c.x),i[l]=c.x,i[l+1]=c.y,i[l+2]=c.z}var d=new THREE.InstancedBufferAttribute(i,3,1);n.addAttribute("translate",d),e.computeBoundingBox();var E=e.boundingBox.max.x-e.boundingBox.min.x,u=(new THREE.TextureLoader).load("assets/images/circle.png"),h=new THREE.ShaderMaterial({vertexShader:SHADERS.instancing.vertex,fragmentShader:SHADERS.instancing.fragment,uniforms:{time:{value:0},minX:{value:r},length:{value:E},map:{value:u}}}),v=new THREE.Mesh(n,h);v.rotation.z=Math.PI/6;v.scale.set(5,5,5);var m=0;return{mesh:v,addToScene:function(){scene.add(v)},update:function(){m+=.025,v.material.uniforms.time.value=m}}},InitPlanet=function(e){var t=new THREE.CircleBufferGeometry(1,6),n=new THREE.InstancedBufferGeometry;n.copy(t);for(var a=e.vertices,o=a.length,r=0,i=new Float32Array(3*o),s=0;s<a.length;s++){var l=3*s,c=a[s];r>c.x&&(r=c.x),i[l]=c.x,i[l+1]=c.y,i[l+2]=c.z}var d=new THREE.InstancedBufferAttribute(i,3,1);n.addAttribute("translate",d),e.computeBoundingBox();e.boundingBox.max.x,e.boundingBox.min.x,(new THREE.TextureLoader).load("assets/images/circle.png");var E=MATERIALS.bubbleGum.clone();E.flatShading=!0;var u=new THREE.Mesh(e,E);u.rotation.z=Math.PI/6;var h=new THREE.Group;h.add(u);for(var v=[],m=[],w=new THREE.SphereGeometry(.25,10,10),s=0;s<3;s++){var p=new THREE.PointLight(16777215,1,9),f=new THREE.MeshBasicMaterial,T=new THREE.Mesh(w,f);p.add(T),v.push(p);var H=new Ellipse(5,5,Math.PI/3*(s+1));m.push(H),h.add(p)}var R=0;return{mesh:h,pointLights:v,update:function(){R+=.001}}},InitAvatar=function(e){return e.update=function(){e.position.y+=.02},e.play=function(){console.log("playing")},e};const ASSETS_PATH="/assets/models/",LOADED_OBJECTS={},KEYCODES={32:"spacebar",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};document.addEventListener("keydown",e=>{e.metaKey||e.preventDefault();let t=codeToKey(e.keyCode);if(t){let e=KEYCODES[t];e&&e.play()}});var Loader=function(){const e=new THREE.LoadingManager,t=new THREE.JSONLoader(e);return e.onProgress=function(e,t,n){console.log(e,t,n)},e.onLoad=function(){init()},this.loadModel=function(e){t.load(ASSETS_PATH+e+".json",function(t,n){MODEL_DATA[e].geometry=t,void 0!==n&&(MODEL_DATA[e].materials=n)})},this}();for(var obj in MODEL_DATA)Loader.loadModel(obj);var camera,outerCamera,scene,renderer,controls,pointLight,pov,domEvents,activeCamera,clock=new THREE.Clock;